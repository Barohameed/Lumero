{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/douglas/pj/lumero/mobile/src/contexts/auth.js\";\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useEffect, useState, createContext, useContext } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport axios from \"../services/api\";\nvar AuthContext = createContext({});\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      user = _useState2[0],\n      setUser = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      showOnboarding = _useState4[0],\n      setShowOnboarding = _useState4[1];\n\n  var _useState5 = useState(true),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  useEffect(function () {\n    function loadStorageData() {\n      var alreadySawTheOnboarding, userSigned;\n      return _regeneratorRuntime.async(function loadStorageData$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@LumeroBooks:passed_by_onboarding\"));\n\n            case 2:\n              alreadySawTheOnboarding = _context.sent;\n              _context.next = 5;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@LumeroBooks:user\"));\n\n            case 5:\n              userSigned = _context.sent;\n              alreadySawTheOnboarding ? setShowOnboarding(false) : setShowOnboarding(true);\n              userSigned ? setUser(JSON.parse(userSigned)) : setUser(null);\n              setLoading(false);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    }\n\n    loadStorageData();\n  }, []);\n\n  function PassedByOnboarding() {\n    return _regeneratorRuntime.async(function PassedByOnboarding$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@LumeroBooks:passed_by_onboarding\", JSON.stringify(true)));\n\n          case 2:\n            setShowOnboarding(false);\n\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function SignIn(_ref2) {\n    var _response$data;\n\n    var email, password, response, _response$data$user, id, _email, username, newUser;\n\n    return _regeneratorRuntime.async(function SignIn$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            email = _ref2.email, password = _ref2.password;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(axios.post(\"user/auth\", {\n              email: email,\n              password: password\n            }));\n\n          case 3:\n            response = _context3.sent;\n            console.log(response.data);\n\n            if ((_response$data = response.data) != null && _response$data.error) {\n              _context3.next = 13;\n              break;\n            }\n\n            _response$data$user = response.data.user, id = _response$data$user.id, _email = _response$data$user.email, username = _response$data$user.username;\n            newUser = {\n              id: id,\n              email: _email,\n              username: username,\n              token: response.data.token\n            };\n            setUser(newUser);\n            _context3.next = 11;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@LumeroBooks:user\", JSON.stringify(newUser)));\n\n          case 11:\n            _context3.next = 14;\n            break;\n\n          case 13:\n            console.log(\"Invalid credentials\");\n\n          case 14:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function SignUp(_ref3) {\n    var _response$data2;\n\n    var email, password, username, response, _response$data$user2, id, _email2, _username, newUser;\n\n    return _regeneratorRuntime.async(function SignUp$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            email = _ref3.email, password = _ref3.password, username = _ref3.username;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(axios.post(\"user/create\", {\n              email: email,\n              username: username,\n              password: password\n            }));\n\n          case 3:\n            response = _context4.sent;\n\n            if ((_response$data2 = response.data) != null && _response$data2.error) {\n              _context4.next = 12;\n              break;\n            }\n\n            _response$data$user2 = response.data.user, id = _response$data$user2.id, _email2 = _response$data$user2.email, _username = _response$data$user2.username;\n            newUser = {\n              id: id,\n              email: _email2,\n              username: _username,\n              token: response.data.token\n            };\n            setUser(newUser);\n            _context4.next = 10;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@LumeroBooks:user\", JSON.stringify(newUser)));\n\n          case 10:\n            _context4.next = 13;\n            break;\n\n          case 12:\n            console.log(\"Invalid credentials\");\n\n          case 13:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  return React.createElement(AuthContext.Provider, {\n    value: {\n      PassedByOnboarding: PassedByOnboarding,\n      SignIn: SignIn,\n      SignUp: SignUp,\n      showOnboarding: showOnboarding,\n      loading: loading,\n      user: user\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 5\n    }\n  }, children);\n};\nexport function useAuth() {\n  var context = useContext(AuthContext);\n  return context;\n}\nexport default AuthContext;","map":{"version":3,"sources":["/home/douglas/pj/lumero/mobile/src/contexts/auth.js"],"names":["React","useEffect","useState","createContext","useContext","AsyncStorage","axios","AuthContext","AuthProvider","children","user","setUser","showOnboarding","setShowOnboarding","loading","setLoading","loadStorageData","getItem","alreadySawTheOnboarding","userSigned","JSON","parse","PassedByOnboarding","setItem","stringify","SignIn","email","password","post","response","console","log","data","error","id","username","newUser","token","SignUp","useAuth","context"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, createContext, useContext } from \"react\";\n\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nimport axios from \"../services/api\";\n\nconst AuthContext = createContext({});\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [showOnboarding, setShowOnboarding] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    async function loadStorageData() {\n      const alreadySawTheOnboarding = await AsyncStorage.getItem(\n        \"@LumeroBooks:passed_by_onboarding\"\n      );\n      const userSigned = await AsyncStorage.getItem(\"@LumeroBooks:user\");\n\n      alreadySawTheOnboarding\n        ? setShowOnboarding(false)\n        : setShowOnboarding(true);\n\n      userSigned ? setUser(JSON.parse(userSigned)) : setUser(null);\n\n      setLoading(false);\n    }\n\n    loadStorageData();\n  }, []);\n\n  async function PassedByOnboarding() {\n    await AsyncStorage.setItem(\n      \"@LumeroBooks:passed_by_onboarding\",\n      JSON.stringify(true)\n    );\n\n    setShowOnboarding(false);\n  }\n\n  async function SignIn({ email, password }) {\n    const response = await axios.post(\"user/auth\", { email, password });\n    console.log(response.data);\n\n    if (!response.data?.error) {\n      const { id, email, username } = response.data.user;\n\n      let newUser = { id, email, username, token: response.data.token };\n\n      setUser(newUser);\n\n      await AsyncStorage.setItem(\"@LumeroBooks:user\", JSON.stringify(newUser));\n    } else {\n      console.log(\"Invalid credentials\");\n    }\n  }\n\n  async function SignUp({ email, password, username }) {\n    const response = await axios.post(\"user/create\", {\n      email,\n      username,\n      password,\n    });\n\n    if (!response.data?.error) {\n      const { id, email, username } = response.data.user;\n\n      let newUser = { id, email, username, token: response.data.token };\n\n      setUser(newUser);\n\n      await AsyncStorage.setItem(\"@LumeroBooks:user\", JSON.stringify(newUser));\n    } else {\n      console.log(\"Invalid credentials\");\n    }\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{\n        PassedByOnboarding,\n        SignIn,\n        SignUp,\n        showOnboarding,\n        loading,\n        user,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n\n  return context;\n}\n\nexport default AuthContext;\n"]},"metadata":{},"sourceType":"module"}